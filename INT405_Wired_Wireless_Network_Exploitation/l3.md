

# **Lab 1: On-Path (MITM) Attacks with Ettercap (Target: OWASP VM)**

---

## **Theory: Understanding On-Path (MITM) Attacks and ARP Spoofing**

### **What is an On-Path (Man-in-the-Middle) Attack?**
An **On-Path Attack**, commonly referred to as a **Man-in-the-Middle (MITM) Attack**, is a type of cyberattack where an attacker secretly intercepts, alters, or relays communication between two parties who believe they are directly communicating with each other. 

In network security, this attack allows an adversary to:
- Eavesdrop on confidential information.
- Manipulate or inject malicious data into the communication.
- Disrupt normal communication.

---

### **What is ARP and Why is it Vulnerable?**

The **Address Resolution Protocol (ARP)** maps IP addresses to MAC addresses within a local network. However, ARP lacks authentication, making it susceptible to spoofing. 

In an **ARP Spoofing Attack**, the attacker sends false ARP replies, tricking devices into associating the attacker's MAC address with another device's IP address (e.g., the default gateway). This enables the attacker to intercept or manipulate traffic.

---

### **How Does Ettercap Perform an ARP Spoofing Attack?**

**Ettercap** is a network security tool used for conducting MITM attacks and testing network security. It simplifies ARP spoofing by:
1. Scanning the network to identify hosts (devices).
2. Poisoning ARP tables to impersonate a trusted device, such as a gateway.
3. Relaying and sniffing the intercepted traffic.

---

### **Lab Scenario**

In this lab, you will:
1. Use **Ettercap** on Kali Linux to perform an **ARP spoofing attack** targeting the **OWASP VM**.
2. Capture and analyze network traffic using **Wireshark**.
3. Document the attack’s impact on the victim machine.

---

## **Lab Objectives**
By the end of this lab, you will:
1. Understand how ARP spoofing works in an MITM attack.
2. Use Ettercap to execute a successful MITM attack.
3. Analyze the impact of ARP spoofing on network communication.
4. Answer theoretical and practical questions to reinforce learning.

---

## **Required Resources**
- **Kali Linux VM** (Attacker machine with Ettercap and Wireshark installed).
- **OWASP VM** (Victim machine).
- Both VMs must be connected to the same network (NAT or Bridged Adapter).

---

## **Step-by-Step Instructions**

---

### **Part 1: Set Up and Verify the Environment**

#### **Step 1.1: Power on and Connect VMs**
1. Launch both **Kali Linux** and **OWASP VM**.
2. Ensure both VMs are connected to the same network (use NAT or Bridged Adapter in VirtualBox/VMware).

#### **Step 1.2: Find OWASP VM’s IP Address**
1. Log in to the OWASP VM.
2. Open a terminal and check the IP address using:
   ```bash
   ip addr show
   ```
3. Note the IP address of the OWASP VM (e.g., `192.168.x.x`).

#### **Step 1.3: Test Network Connectivity**
1. On Kali Linux, open a terminal and ping the OWASP VM:
   ```bash
   ping -c 4 <OWASP_VM_IP>
   ```
   Replace `<OWASP_VM_IP>` with the actual IP address of the OWASP VM.
2. Confirm successful communication.

---

### **Part 2: Install Ettercap on Kali Linux**

#### **Step 2.1: Update the Package List**
1. Open a terminal on Kali Linux and update the system:
   ```bash
   sudo apt update
   ```

#### **Step 2.2: Install Ettercap**
1. Install Ettercap using:
   ```bash
   sudo apt install ettercap-graphical -y
   ```

#### **Step 2.3: Verify Installation**
1. Confirm that Ettercap is installed:
   ```bash
   ettercap --version
   ```
2. Launch the GUI to test functionality:
   ```bash
   sudo ettercap -G
   ```
   - Close Ettercap after verifying it opens successfully.

---

### **Part 3: Perform ARP Spoofing Attack on OWASP VM**

#### **Step 3.1: Launch Ettercap**
1. Open a terminal on Kali Linux.
2. Start Ettercap in GUI mode:
   ```bash
   sudo ettercap -G
   ```

#### **Step 3.2: Set the Sniffing Interface**
1. In the Ettercap GUI, go to **Sniff > Unified Sniffing**.
2. Select your network interface (e.g., `eth0`) and click **OK**.

#### **Step 3.3: Scan the Network for Devices**
1. In Ettercap, go to **Hosts > Scan for Hosts**.
2. View the discovered devices by navigating to **Hosts > Host List**.
3. Identify the **OWASP VM** and note its IP and MAC address.

#### **Step 3.4: Add Targets**
1. In the Host List:
   - Select the **OWASP VM** as **Target 1**.
   - Select the **Default Gateway** (e.g., `192.168.1.1`) as **Target 2**.
2. Confirm both targets are added.

#### **Step 3.5: Start ARP Poisoning**
1. Go to **MITM > ARP Poisoning**.
2. Select **Sniff remote connections** and click **OK**.
3. Monitor the status in the Ettercap GUI.

---

### **Part 4: Analyze Traffic with Wireshark**

#### **Step 4.1: Launch Wireshark**
1. On Kali Linux, start Wireshark and select the same network interface used in Ettercap.
2. Apply the ARP filter to focus on ARP traffic:
   ```
   arp
   ```

#### **Step 4.2: Generate Traffic on OWASP VM**
1. On the OWASP VM, open a terminal and generate network traffic:
   ```bash
   ping -c 5 192.168.1.1
   ```
   Replace `192.168.1.1` with the gateway’s IP address.

#### **Step 4.3: Observe and Save Traffic**
1. In Wireshark, observe ARP spoofing packets.
2. Stop the capture once packets are visible.
3. Save the capture file as `arp_spoofing.pcap`.

---

### **Part 5: Verify and Document Results**

#### **Step 5.1: Check ARP Cache on OWASP VM**
1. On the OWASP VM, check the ARP cache before and after the attack:
   ```bash
   ip neighbor
   ```
2. Record any changes in the MAC address of the gateway.

#### **Step 5.2: Analyze the Impact**
1. Determine how the poisoned ARP cache affects communication.

#### **Step 5.3: Generate a Lab Report**
- Include screenshots of:
  1. ARP cache before and after the attack.
  2. Wireshark capture showing ARP spoofing packets.
- Answer the lab questions below.

---

## **Lab Questions**

1. **What is the IP address and MAC address of the OWASP VM?**
   - [Answer]

2. **What is the MAC address of the Kali Linux VM (attacker)?**
   - [Answer]

3. **What changes were observed in the ARP cache of the OWASP VM after the attack?**
   - [Answer]

4. **What packets did you capture in Wireshark, and what do they indicate?**
   - [Answer]

5. **How does ARP poisoning enable a Man-in-the-Middle attack?**
   - [Answer]

6. **Explain the purpose of the following Ettercap commands:**
   - `-G`
   - `-T`
   - `--mitm arp`
   - `/target1// /target2//`
   - [Answer]

7. **What are the implications of ARP spoofing on network security?**
   - [Answer]

8. **IP-MAC Address Table (Before and After ARP Poisoning):**
   | IP Address  | MAC Address (Before) | MAC Address (After) | Role      |
   | ----------- | --------------------- | ------------------- | --------- |
   | 192.168.1.1 | [Answer]              | [Answer]            | Gateway   |
   | OWASP VM    | [Answer]              | [Answer]            | Victim    |
   | Kali Linux  | [Answer]              | [Answer]            | Attacker  |

---

### **Submission Requirements**
- Lab report including:
  - Answers to all questions.
  - Screenshots of ARP cache, Wireshark captures, and Ettercap configuration.
  - The `.pcap` file from Wireshark.

--- 
