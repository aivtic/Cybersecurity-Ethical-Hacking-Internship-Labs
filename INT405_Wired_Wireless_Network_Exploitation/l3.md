# Lab 3: On-Path Attacks with Ettercap

---

### **Objectives**
1. **Launch Ettercap and Explore Its Capabilities**
2. **Perform an On-Path (MITM) Attack**
3. **Capture ARP Spoofing Traffic with Wireshark**

---

### **Background / Scenario**
On-path attacks, also known as MITM attacks, enable adversaries to intercept, manipulate, and capture data transmitted across a network. In this lab, students will use their **OWASP VM** to simulate a real-world attack scenario. You'll perform an ARP spoofing attack using **Ettercap** and analyze network traffic using **Wireshark**.

---

### **Required Resources**
- Kali Linux VM with pre-installed tools (Ettercap, Wireshark)
- Your **OWASP VM IP address** (configured for network communication)
- SSH-enabled target on OWASP VM (or a simulated victim machine)

---

## **Part 1: Launch Ettercap and Explore Its Capabilities**

### **Step 1: Identify and Set Up the Target Machine**
1. Launch your Kali Linux VM.
2. Determine the IP address of your **OWASP VM**. Use the command:
   ```bash
   ip addr show
   ```
   - Note your OWASP VM's internal IP address (e.g., `192.168.x.x`).

3. SSH into your OWASP VM using its IP address:
   ```bash
   ssh -l labuser <Your OWASP VM IP>
   ```
   Replace `<Your OWASP VM IP>` with your actual IP.

4. Verify the ARP cache on your OWASP VM:
   ```bash
   ip neighbor
   ```

---

### **Step 2: Launch Ettercap**
1. Open a terminal in Kali Linux and start the Ettercap GUI:
   ```bash
   sudo ettercap -G
   ```

2. Set the sniffing interface:
   - In Ettercap GUI, go to **Sniff > Unified Sniffing**.
   - Choose the interface connected to your OWASP VM network (e.g., `eth0` or `br-internal`).

---

## **Part 2: Perform the On-Path (MITM) Attack**

### **Step 1: Select Target Machines**
1. In the Ettercap GUI:
   - Go to **Hosts > Scan for Hosts**.
   - After scanning, view the list of devices connected to the network using **Hosts > Hosts List**.

2. Assign targets:
   - Add your OWASP VM's IP address as **Target 1**.
   - Add another device's IP address (or the gateway IP) as **Target 2**.

---

### **Step 2: Initiate the ARP Spoofing Attack**
1. Perform ARP poisoning:
   - In Ettercap, click on the **MITM** icon and select **ARP Poisoning**.
   - Enable **Sniff remote connections** if prompted.

2. From your SSH session into the OWASP VM, initiate network activity:
   ```bash
   ping -c 5 <Target 2 IP>
   ```
   Replace `<Target 2 IP>` with the IP address of the other machine or gateway.

3. Recheck the ARP table on your OWASP VM:
   ```bash
   ip neighbor
   ```

---

## **Part 3: Observe ARP Spoofing with Wireshark**

### **Step 1: Capture Network Traffic**
1. Open **Wireshark** on your Kali Linux VM.
2. Start a capture on the same interface used by Ettercap (e.g., `br-internal`).
3. Observe ARP packets exchanged between your OWASP VM and the other device.

### **Step 2: Save and Analyze Traffic**
1. Stop the Wireshark capture and save the traffic as `arp_spoofing.pcap`.
2. Identify ARP "Who-has" requests and replies:
   - Highlight changes in MAC addresses for the targeted IPs.

---

## **Lab Report Sections**

1. **How many entries are there in the ARP cache before and after the attack?**
   - Before: [Answer]
   - After: [Answer]

2. **What is the MAC address of your OWASP VM?**
   - [Answer]

3. **What happens to the MAC address associated with the target IP after ARP spoofing?**
   - [Answer]

4. **Describe how Wireshark captures confirm the ARP spoofing attack.**
   - [Answer]

5. **IP-MAC Address Table (Post-Attack)**:
   | IP Address       | MAC Address      | Role                 |
   | ---------------- | ---------------  | -------------------- |
   | OWASP VM         | [Answer]         | Attacker             |
   | Gateway/Device   | [Answer]         | Target 2 (gateway)   |
   | Another Device   | [Answer]         | Victim               |

6. **Explain the significance of ARP spoofing in real-world scenarios.**
   - [Answer]

---

## **Key Terms**
- **OWASP VM IP**: The unique IP address assigned to your OWASP VM in the lab environment.
- **ARP Spoofing**: A method to redirect traffic between devices by forging ARP messages.
- **Ettercap**: A powerful suite for MITM attacks on LAN networks.
- **Wireshark**: A network protocol analyzer used to observe and save packet data.
- **Target 1 and Target 2**: The devices chosen for ARP spoofing in the lab.

---

### **Submission**
Submit a detailed report with:
- Screenshots of ARP cache (before and after spoofing)
- A saved Wireshark capture file (`arp_spoofing.pcap`)
- Answers to the lab questions above.
