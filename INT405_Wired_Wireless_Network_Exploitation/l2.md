# Lab 2: Scanning for SMB Vulnerabilities with `enum4linux`

#### Objectives:
In this lab, you will:
1. Launch `enum4linux` and explore its capabilities.
2. Identify computers with SMB services running.
3. Use `enum4linux` to enumerate users and network file shares.
4. Use `smbclient` to transfer files between systems.

#### Background / Scenario:
Windows server networks, if poorly secured and managed, pose significant security risks. As a penetration tester, it is essential to uncover vulnerabilities in file and print sharing functionalities that could leave an organization open to attacks. In this lab, you will use the `enum4linux` tool to enumerate user and file-sharing information from Samba servers. You will also learn how to transfer files between systems using `smbclient`.

#### Required Resources:
- Kali Linux VM
- Internet connection
- Samba service running on the target system
OWASP VM IP
---

### Instructions:

### Part 1: Launch `enum4linux` and Explore its Capabilities
#### Step 1: Verify that `enum4linux` is Installed and View the Help File
1. Start your Kali Linux VM, log in with the credentials `kali/kali`.
2. Open a terminal window.
3. Obtain root access by typing the command: 
   ```bash
   sudo su
   ```
4. Verify that `enum4linux` is installed by entering:
   ```bash
   enum4linux --help
   ```
5. Review the available options in the help file.

**Question:** What Samba utilities does the help file indicate are used by the `enum4linux` tool?

#### Step 2: Research SMB Terms
Familiarize yourself with the following terms related to SMB and Windows networks:
- **Relative Identifier (RID)**
- **Security Identifier (SID)**
- **Domain Controller (DC)**
- **Lightweight Directory Access Protocol (LDAP)**
- **Workgroup**

Provide a brief definition of each term after researching.

---

### Part 2: Use `nmap` to Find SMB Servers
#### Step 1: Scan the Virtual Networks to Find Potential Targets
1. Use `nmap` to scan for services available on hosts in the 172.17.0.0/24 subnet:
   ```bash
   nmap -sN OWASP VM IP/24
   ```
   
2. Record the information provided by `nmap`, focusing on the ports and services related to SMB, such as:
   - TCP 135 (RPC)
   - TCP 139 (NetBIOS)
   - TCP 445 (SMB File Service)
   - TCP 389 (LDAP)
   - UDP 137 (NetBIOS Name Service)

**Question:** What ports are open on the host, and what services does `nmap` identify?

#### Step 2: Scan the OWASP VM IP/24 Subnet for SMB Services
1. Perform a similar scan on the OWASP VM IP/24 subnet:
   ```bash
   nmap -sN OWASP VM IP/24
   ```
   
2. Identify any potential target computers running SMB services.

**Question:** Are there any SMB servers running in this subnet? How do you know?

---

### Part 3: Use `enum4linux` to Enumerate Users and Network File Shares
#### Step 1: Perform a `enum4linux` Scan on Target OWASP VM IP
1. Use `enum4linux` to list users configured on the target:
   ```bash
   enum4linux -U OWASP VM IP
   ```
   
2. Use the following command to list the available file shares on the target (in verbose mode):
   ```bash
   enum4linux -Sv OWASP VM IP
   ```

**Question:** Which Samba tool was used to map the file shares? How many shares are listed, and what does the `$` symbol at the end of the share name represent?

#### Step 2: Perform a Simple Enumeration Scan on Target OWASP VM IP
1. Combine multiple enumeration options using the `-a` flag:
   ```bash
   enum4linux -a OWASP VM IP
   ```

2. Review the output to identify local users and groups, as well as network shares.

**Question:** How many local users and groups are found on this target? What file shares are available?

---

### Part 4: Use `smbclient` to Transfer Files Between Systems
#### Step 1: Use `smbclient` to List Shares and Connect to a Target
1. Create a text file to simulate malware:
   ```bash
   cat >> badfile.txt
   ```
   Add the following content: 
   ```
   This is a bad file.
   ```
   Press `Ctrl+C` to save the file.
   
2. List the available shares on the target:
   ```bash
   smbclient -L //OWASP VM IP/
   ```
   
3. Connect to the `tmp` share on the target:
   ```bash
   smbclient //OWASP VM IP/tmp
   ```
   Press `Enter` when prompted for the password.

4. Use the `put` command to upload the file to the server:
   ```bash
   put badfile.txt badfile.txt
   ```
   
5. Verify the upload by typing `dir` to list the files in the share.

6. Exit the session by typing `quit`.

---

### Reflection
**Scenario:** During a penetration test, you gain access to an internal network through social engineering, and you're able to remotely access the network using `enum4linux`. How would you proceed to send a dummy malware file to hosts on the network?

**Submission Instructions:**
- Complete the lab steps and answer all the questions in each part.
- Save your answers and any relevant screenshots in a document.
- Submit the completed document as a PDF or ZIP file.
